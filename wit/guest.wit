interface incoming-handler {
    use types.{client, error, message, topic};

    /// Whenever this guest receives a message in one of the subscribed topics, the message is
    /// sent to this handler. The guest is responsible for matching on the topic and handling the
    /// message accordingly. Implementors (such as hosts) calling this interface should make their
    /// own decisions on how to handle errors returned from this function.
    handle: async func(message: message) -> result<_, error>;

    /// A client-specific topic the guest subscribes to.
    record client-topic {
        client: client,
        topic: topic,
    }

    /// Server configuration.
    ///
    /// This can be extended to include other configuration options in the
    /// future.
    record configuration {
        /// Subscription topics
        topics: list<client-topic>,
    }

    /// Configure is called by the runtime to get the server's runtime
    /// configuration.
    configure: async func() -> result<configuration, error>;

}
